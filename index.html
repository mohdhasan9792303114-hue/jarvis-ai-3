<!DOCTYPE html>
<html>
<head>
<title>JARVIS ULTIMATE GOD BUILD</title>

<style>
body{background:black;color:white;font-family:Arial;margin:0;}
header{background:#003cff;padding:12px;text-align:center;}

#sidebar{
position:fixed;
left:0;top:0;width:230px;height:100%;
background:#111;overflow:auto;padding:10px;
border-right:1px solid #333;
}

#main{margin-left:230px;}
#chat{height:55vh;overflow:auto;padding:10px;}
textarea{width:100%;height:85px;background:#222;color:white;}
button{padding:10px;margin:2px;background:#007acc;color:white;border:none;}

.tab{padding:6px;background:#222;margin:4px;cursor:pointer;}
.historyItem{padding:6px;border-bottom:1px solid #333;cursor:pointer;color:#ccc;}

.settings{
position:fixed;right:0;top:0;width:260px;height:100%;
background:#111;padding:10px;display:none;
}
</style>
</head>

<body>

<header>ğŸ¤– JARVIS ULTIMATE GOD BUILD</header>

<div id="sidebar">
<h3>Conversations</h3>
<div id="tabs"></div>
<button onclick="newTab()">â• New Chat</button>

<h3>History</h3>
<div id="historyList"></div>
<button onclick="clearChat()">ğŸ—‘ Delete Chat</button>
</div>

<div id="main">
<div id="chat"></div>
<textarea id="input"></textarea>

<div>
<button onclick="send()">Send</button>
<button onclick="voiceInput()">ğŸ¤ Voice</button>
<button onclick="toggleGender()">ğŸ‘¤ Gender</button>
<button onclick="toggleLang()">ğŸŒ Lang</button>
<button onclick="toggleWake()">ğŸ§  Wake</button>
<button onclick="backup()">ğŸ’¾ Backup</button>
<button onclick="openSettings()">âš™ Settings</button>
</div>
</div>

<div class="settings" id="settingsPanel">
<h3>Settings</h3>
<button onclick="toggleGender()">Switch Voice Gender</button>
<button onclick="toggleLang()">Switch Language</button>
<button onclick="toggleCloud()">Cloud Sync</button>
<button onclick="connectLLM()">Connect AI Brain</button>
<button onclick="closeSettings()">Close</button>
</div>

<script>

/* ===== SAFE DATABASE LOAD ===== */

let db;

try{
db = JSON.parse(localStorage.getItem("jarvis_db")) || {};
}catch{
db={};
}

db.memory ??= {};
db.vector ??= [];
db.tabs ??= {default:[]};
db.activeTab ??= "default";
db.wake ??= false;
db.voiceGender ??= "female";
db.language ??= "en";
db.cloud ??= false;
db.llmKey ??= "";

function save(){localStorage.setItem("jarvis_db",JSON.stringify(db));}

/* ===== DOM ===== */

let chat=document.getElementById("chat");
let input=document.getElementById("input");
let tabs=document.getElementById("tabs");
let historyList=document.getElementById("historyList");
let settingsPanel=document.getElementById("settingsPanel");

/* ===== SAFE RENDER ===== */

function renderMessage(role,text){

let div=document.createElement("div");
div.textContent=(role==="user"?"You":"Jarvis")+": "+text;

chat.appendChild(div);
chat.scrollTop=chat.scrollHeight;
}

/* ===== SETTINGS ===== */

function openSettings(){ if(settingsPanel) settingsPanel.style.display="block"; }
function closeSettings(){ if(settingsPanel) settingsPanel.style.display="none"; }

/* ===== TABS ===== */

function newTab(){

let name="chat"+Date.now();
db.tabs[name]=[];
db.activeTab=name;
save();

updateTabs();
loadTab();
}

function updateTabs(){

tabs.innerHTML="";

Object.keys(db.tabs).forEach(tab=>{

let d=document.createElement("div");
d.className="tab";
d.innerText=tab;

d.onclick=()=>{
db.activeTab=tab;
loadTab();
};

tabs.appendChild(d);

});
}

function loadTab(){

if(!db.tabs[db.activeTab]) db.activeTab="default";

chat.innerHTML="";

db.tabs[db.activeTab].forEach(m=>{
renderMessage(m.role,m.text);
});

updateHistorySidebar();
}

/* ===== HISTORY ===== */

function updateHistorySidebar(){

historyList.innerHTML="";

(db.tabs[db.activeTab] || []).slice(-20).forEach(h=>{

let d=document.createElement("div");
d.className="historyItem";
d.innerText=h.text;

historyList.appendChild(d);

});
}

/* ===== CHAT ADD ===== */

function add(role,text){

renderMessage(role,text);

db.tabs[db.activeTab].push({role,text});
updateHistorySidebar();
save();

if(role==="ai") speak(text);
}

/* ===== CLEAR CHAT ===== */

function clearChat(){

db.tabs[db.activeTab]=[];
chat.innerHTML="";
save();
}

/* ===== VOICE ===== */

function speak(text){

try{
let u=new SpeechSynthesisUtterance(text);
u.lang=db.language==="hi"?"hi-IN":"en-US";

speechSynthesis.cancel();
speechSynthesis.speak(u);
}catch{}
}

document.body.addEventListener("click",()=>{
try{speechSynthesis.resume();}catch{}
});

function voiceInput(){

let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){alert("Voice unsupported");return;}

let r=new SR();
r.lang=db.language==="hi"?"hi-IN":"en-US";

r.onresult=e=>{
input.value=e.results[0][0].transcript;
send();
};

r.start();
}

/* ===== WAKE ===== */

let wakeRec=null;

function toggleWake(){

db.wake=!db.wake;
save();

add("ai","Wake "+db.wake);

if(db.wake && !wakeRec) startWake();
else if(!db.wake && wakeRec){
wakeRec.stop();
wakeRec=null;
}
}

function startWake(){

let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR) return;

wakeRec=new SR();
wakeRec.continuous=true;

wakeRec.onresult=e=>{
let t=e.results[e.results.length-1][0].transcript.toLowerCase();

if(t.includes("jarvis")){
input.value=t.replace("jarvis","");
send();
}
};

try{wakeRec.start();}catch{}
}

/* ===== TRAIN ===== */

function vectorStore(q,a){

db.vector.push({q,a});
if(db.vector.length>400) db.vector.shift();

save();
}

function vectorSearch(text){

for(let v of db.vector){
if(text.includes(v.q)) return v.a;
}

return null;
}

/* ===== CLOUD ===== */

function toggleCloud(){

db.cloud=!db.cloud;
save();

if(db.cloud){
fetch("https://jsonblob.com/api/jsonBlob",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(db)
}).catch(()=>{});
}

add("ai","Cloud "+db.cloud);
}

/* ===== LLM ===== */

async function connectLLM(){

let key=prompt("Enter API Key");
if(!key) return;

db.llmKey=key;
save();

add("ai","LLM Connected");
}

async function askLLM(text){

if(!db.llmKey) return null;

try{

let r=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+db.llmKey
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[{role:"user",content:text}]
})
});

let j=await r.json();

return j?.choices?.[0]?.message?.content || null;

}catch{
return null;
}
}

/* ===== THINK ===== */

async function think(text){

if(text.startsWith("train:")){

let parts=text.replace("train:","").split("|");
if(parts.length<2) return "Format: train: question | answer";

let q=parts[0].trim();
let a=parts[1].trim();

db.memory[q]=a;
vectorStore(q,a);

return "Training saved";
}

let v=vectorSearch(text);
if(v) return v;

if(db.memory[text]) return db.memory[text];

let llm=await askLLM(text);
if(llm) return llm;

return "ğŸ¤– Talk or train me";
}

/* ===== SEND ===== */

async function send(){

let msg=input.value.trim();
if(!msg) return;

add("user",msg);
add("ai","Thinking...");

let reply=await think(msg);

if(chat.lastChild) chat.removeChild(chat.lastChild);

add("ai",reply);

input.value="";
}

/* ===== BACKUP ===== */

function backup(){

let blob=new Blob([JSON.stringify(db,null,2)]);
let a=document.createElement("a");

a.href=URL.createObjectURL(blob);
a.download="jarvis_backup.json";
a.click();
}

/* ===== TOGGLES ===== */

function toggleGender(){
db.voiceGender=db.voiceGender==="female"?"male":"female";
add("ai","Gender switched");
save();
}

function toggleLang(){
db.language=db.language==="en"?"hi":"en";
add("ai","Language switched");
save();
}

/* ===== START ===== */

updateTabs();
loadTab();
add("ai","ğŸš€ Jarvis Ultimate Ready");

</script>
</body>
</html>
