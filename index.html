<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>JARVIS AI CORE</title>

<link rel="manifest" href="manifest.json">

<style>

body{
background:#0f172a;
color:white;
font-family:Arial;
margin:0;
overflow:hidden;
}

/* HEADER */

header{
background:#0ea5e9;
padding:12px;
display:flex;
align-items:center;
gap:12px;
}

#menuBtn{
font-size:22px;
cursor:pointer;
}

#userEmail{
font-size:12px;
margin-left:auto;
}

/* SIDEBAR */

#sidebar{
position:fixed;
top:0;
left:-260px;
width:260px;
height:100%;
background:#020617;
transition:.3s;
padding:12px;
z-index:999;
overflow:auto;
}

#sidebar.open{
left:0;
}

#closeSidebar{
float:right;
cursor:pointer;
}

/* CHAT */

#chat{
position:fixed;
top:60px;
bottom:70px;
width:100%;
overflow:auto;
padding:10px;
}

.user{color:#34d399;}
.ai{color:#38bdf8;}

/* INPUT */

#inputBar{
position:fixed;
bottom:0;
width:100%;
background:#020617;
padding:8px;
display:flex;
gap:6px;
}

textarea{
flex:1;
height:50px;
background:#1e293b;
color:white;
border:none;
resize:none;
}

button{
background:#0ea5e9;
border:none;
color:white;
padding:10px;
cursor:pointer;
}

.tab{
background:#1e293b;
margin:6px 0;
padding:8px;
display:flex;
justify-content:space-between;
cursor:pointer;
}

.deleteBtn{
color:red;
cursor:pointer;
}

</style>
</head>

<body>

<!-- SIDEBAR -->

<div id="sidebar">

<span id="closeSidebar">‚ùå</span>

<h3>Chats</h3>
<div id="tabs"></div>

<button onclick="newChat()">New Chat</button>
<button onclick="jarvisLogin()">Cloud Login</button>

</div>

<header>
<span id="menuBtn">‚ò∞</span>
<b>JARVIS AI</b>
<div id="userEmail">Not Logged</div>
</header>

<div id="chat"></div>

<div id="inputBar">
<textarea id="input"></textarea>
<button onclick="send()">Send</button>
<button onclick="voiceInput()">üé§</button>
</div>

<script>

/* DATABASE */

let db = JSON.parse(localStorage.getItem("jarvisDB")) || {
tabs:{default:[]},
activeTab:"default",
memory:{},
vector:[]
};

function save(){
localStorage.setItem("jarvisDB",JSON.stringify(db));
}

/* DOM */

let chat=document.getElementById("chat");
let input=document.getElementById("input");
let tabs=document.getElementById("tabs");
let sidebar=document.getElementById("sidebar");
let menuBtn=document.getElementById("menuBtn");
let closeSidebar=document.getElementById("closeSidebar");

/* SIDEBAR CONTROL */

menuBtn.onclick=()=> sidebar.classList.add("open");
closeSidebar.onclick=()=> sidebar.classList.remove("open");

/* RENDER */

function render(role,text){

let d=document.createElement("div");
d.className=role;
d.textContent=(role==="user"?"You: ":"Jarvis: ")+text;

chat.appendChild(d);
chat.scrollTop=chat.scrollHeight;

}

/* ADD MESSAGE */

function add(role,text){

render(role,text);

if(!db.tabs[db.activeTab])
db.tabs[db.activeTab]=[];

db.tabs[db.activeTab].push({role,text});
save();

}

/* NEW CHAT */

function newChat(){

let id="chat"+Date.now();

db.tabs[id]=[];
db.activeTab=id;

save();
loadTabs();
loadChat();

}

/* DELETE CHAT */

function deleteChat(id){

if(!db.tabs[id]) return;

if(confirm("Delete Chat?")){
delete db.tabs[id];
db.activeTab="default";
save();
loadTabs();
loadChat();
}

}

/* LOAD TABS */

function loadTabs(){

tabs.innerHTML="";

Object.keys(db.tabs).forEach(t=>{

let div=document.createElement("div");
div.className="tab";

div.innerHTML=`
<span onclick="switchChat('${t}')">${t}</span>
<span class="deleteBtn" onclick="deleteChat('${t}')">‚ùå</span>
`;

tabs.appendChild(div);

});

}

/* SWITCH CHAT */

function switchChat(id){
db.activeTab=id;
loadChat();
sidebar.classList.remove("open");
}

/* LOAD CHAT */

function loadChat(){

chat.innerHTML="";

(db.tabs[db.activeTab]||[]).forEach(m=>{
render(m.role,m.text);
});

}

/* SIMPLE AI */

function think(text){

text=text.toLowerCase();

if(text==="hello") return "Hello Owner";

if(db.memory[text]) return db.memory[text];

return "Awaiting Training";

}

/* SEND */

function send(){

let msg=input.value.trim();
if(!msg) return;

add("user",msg);
add("ai",think(msg));

input.value="";

}

/* VOICE PLACEHOLDER */

function voiceInput(){
alert("Voice coming soon");
}

/* START */

loadTabs();
loadChat();

if(!sessionStorage.getItem("jarvisStart")){
add("ai","JARVIS CORE ONLINE");
sessionStorage.setItem("jarvisStart","1");
}

</script>

<!-- CLOUD -->

<script type="module">

import { jarvisLogin } from "./cloudSync.js";

window.jarvisLogin = async ()=>{

try{

let user = await jarvisLogin();

if(user){
document.getElementById("userEmail").innerText=user.email;
}

}catch{
alert("Cloud Login Failed");
}

};

</script>

</body>
</html>
