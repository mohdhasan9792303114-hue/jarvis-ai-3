<!DOCTYPE html>
<html>
<head>
<title>JARVIS ULTIMATE GOD BUILD</title>

<style>
body{background:black;color:white;font-family:Arial;margin:0;}
header{background:#003cff;padding:12px;text-align:center;}

#sidebar{
position:fixed;
left:0;
top:0;
width:230px;
height:100%;
background:#111;
overflow:auto;
padding:10px;
border-right:1px solid #333;
}

#main{margin-left:230px;}

#chat{height:55vh;overflow:auto;padding:10px;}
textarea{width:100%;height:85px;background:#222;color:white;}
button{padding:10px;margin:2px;background:#007acc;color:white;border:none;}

.historyItem{
padding:6px;
border-bottom:1px solid #333;
cursor:pointer;
color:#ccc;
}

.tab{
padding:6px;
background:#222;
margin:4px;
cursor:pointer;
}
</style>
</head>

<body>

<header>ðŸ¤– JARVIS ULTIMATE GOD BUILD</header>

<div id="sidebar">

<h3>Conversations</h3>
<div id="tabs"></div>

<button onclick="newTab()">âž• New Chat</button>

<h3>History</h3>
<div id="historyList"></div>

<button onclick="clearChat()">ðŸ—‘ Delete Chat</button>

</div>

<div id="main">

<div id="chat"></div>
<textarea id="input"></textarea>

<div>
<button onclick="send()">Send</button>
<button onclick="voiceInput()">ðŸŽ¤ Voice</button>
<button onclick="toggleWake()">ðŸ§  Wake</button>
<button onclick="backup()">ðŸ’¾ Backup</button>
<button onclick="connectLLM()">ðŸ§  Connect AI</button>
</div>

</div>

<script>

// ================= SAFE DATABASE =================

let db = JSON.parse(localStorage.getItem("jarvis_db") || `{
memory:{},
vector:[],
tabs:{default:[]},
activeTab:"default",
wake:false,
llmKey:""
}`);

if(!db.tabs) db.tabs={default:[]};
if(!db.activeTab) db.activeTab="default";

function save(){
localStorage.setItem("jarvis_db",JSON.stringify(db));
}

let chat=document.getElementById("chat");
let input=document.getElementById("input");

// ================= TAB SYSTEM =================

function newTab(){
let name="chat_"+Date.now();
db.tabs[name]=[];
db.activeTab=name;
save();
updateTabs();
loadTab();
}

function updateTabs(){
let t=document.getElementById("tabs");
t.innerHTML="";

Object.keys(db.tabs).forEach(tab=>{
let d=document.createElement("div");
d.className="tab";
d.innerText=tab;

d.onclick=()=>{
db.activeTab=tab;
save();
loadTab();
};

t.appendChild(d);
});
}

function loadTab(){
chat.innerHTML="";
if(!db.tabs[db.activeTab]) db.tabs[db.activeTab]=[];

db.tabs[db.activeTab].forEach(m=>{
chat.innerHTML+=`<div>${m.role=="user"?"You":"Jarvis"}: ${m.text}</div>`;
});

updateHistorySidebar();
}

// ================= HISTORY =================

function updateHistorySidebar(){
let list=document.getElementById("historyList");
list.innerHTML="";

db.tabs[db.activeTab].slice(-20).forEach(h=>{
let d=document.createElement("div");
d.className="historyItem";
d.innerText=h.text;
list.appendChild(d);
});
}

// ================= CHAT =================

function add(role,text){

chat.innerHTML+=`<div>${role=="user"?"You":"Jarvis"}: ${text}</div>`;
chat.scrollTop=chat.scrollHeight;

db.tabs[db.activeTab].push({role,text});
updateHistorySidebar();
save();

if(role=="ai") speak(text);
}

// ================= DELETE =================

function clearChat(){
db.tabs[db.activeTab]=[];
chat.innerHTML="";
save();
}

// ================= VOICE OUTPUT =================

function speak(text){

function run(){

let u=new SpeechSynthesisUtterance(text);
u.lang="en-US";

speechSynthesis.cancel();
speechSynthesis.speak(u);
}

if(!speechSynthesis.getVoices().length){
speechSynthesis.onvoiceschanged=run;
}else run();
}

// ================= VOICE INPUT =================

function voiceInput(){

let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){alert("Voice unsupported");return;}

let r=new SR();

r.onresult=e=>{
input.value=e.results[0][0].transcript;
send();
};

r.start();
}

// ================= WAKE =================

function toggleWake(){
db.wake=!db.wake;
save();
add("ai","Wake mode: "+db.wake);
if(db.wake) startWake();
}

function startWake(){

let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR) return;

let r=new SR();
r.continuous=true;

r.onresult=e=>{
let t=e.results[e.results.length-1][0].transcript.toLowerCase();
if(t.includes("jarvis")){
input.value=t.replace("jarvis","");
send();
}
};

try{r.start();}catch{}
}

// ================= VECTOR MEMORY =================

function vectorStore(q,a){
db.vector.push({q,a});
save();
}

function vectorSearch(text){
for(let v of db.vector){
if(text.includes(v.q)) return v.a;
}
return null;
}

// ================= LLM CONNECT =================

function connectLLM(){
let key=prompt("Enter OpenAI Key");
if(!key) return;
db.llmKey=key;
save();
add("ai","AI Connected");
}

async function askLLM(text){

if(!db.llmKey) return null;

try{

let r=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+db.llmKey
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[{role:"user",content:text}]
})
});

let j=await r.json();
return j.choices?.[0]?.message?.content;

}catch{
return null;
}
}

// ================= AI CORE =================

async function think(text){

if(text.startsWith("train:")){
let [q,a]=text.replace("train:","").split("|");
db.memory[q.trim()]=a.trim();
vectorStore(q.trim(),a.trim());
save();
return "Training saved";
}

let v=vectorSearch(text);
if(v) return v;

if(db.memory[text]) return db.memory[text];

let llm=await askLLM(text);
if(llm) return llm;

return "ðŸ¤– Talk or train me";
}

// ================= SEND =================

async function send(){

let msg=input.value.trim();
if(!msg) return;

add("user",msg);
add("ai","Thinking...");

let reply=await think(msg);

chat.lastChild.remove();
add("ai",reply);

input.value="";
}

// ================= BACKUP =================

function backup(){
let blob=new Blob([JSON.stringify(db,null,2)]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="jarvis_backup.json";
a.click();
}

// ================= START =================

updateTabs();
loadTab();
add("ai","ðŸš€ Jarvis Ultimate Ready");

</script>

</body>
</html>
let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){alert("Voice unsupported");return;}

let r=new SR();
r.lang=db.language=="hi"?"hi-IN":"en-US";

r.onresult=e=>{
input.value=e.results[0][0].transcript;
send();
};

r.start();
}


// ================= WAKE LISTENER =================
function toggleWake(){
db.wake=!db.wake;
save();
add("ai","Wake mode: "+db.wake);
if(db.wake) startWake();
}

function startWake(){

let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR) return;

let r=new SR();
r.continuous=true;

r.onresult=e=>{
let t=e.results[e.results.length-1][0].transcript.toLowerCase();
if(t.includes("jarvis")){
input.value=t.replace("jarvis","");
send();
}
};

try{r.start();}catch{}
}


// ================= VECTOR MEMORY (Improved scoring) =================
function similarity(a,b){

a=a.toLowerCase().split(" ");
b=b.toLowerCase();

let score=0;
a.forEach(w=>{
if(b.includes(w)) score++;
});
return score/a.length;
}

function vectorSearch(text){
for(let v of db.vector){
if(similarity(text,v.q)>0.5) return v.a;
}
return null;
}

function vectorStore(q,a){
db.vector.push({q,a});
if(db.vector.length>400) db.vector.shift();
save();
}


// ================= MODULE SAFE ENGINE =================
async function runModules(text){

for(let m in db.modules){

let mod=db.modules[m];
if(!mod.enabled) continue;

try{
let fn=new Function("text","db","add",mod.code);
let res=await fn(text,db,add);
if(res) return res;
}catch{
mod.enabled=false;
add("ai","âš  Module disabled: "+m);

