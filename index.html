<!DOCTYPE html>
<html>
<head>
<title>JARVIS 15 AUTONOMOUS SELF EVOLVING AI</title>

<link rel="manifest" href="manifest.json">

<style>
body{background:black;color:white;font-family:Arial;margin:0;}
header{background:#001cff;padding:12px;text-align:center;}

#sidebar{
position:fixed;left:0;top:0;width:230px;height:100%;
background:#111;overflow:auto;padding:10px;border-right:1px solid #333;
}

#main{margin-left:230px;}
#chat{height:55vh;overflow:auto;padding:10px;}
textarea{width:100%;height:80px;background:#222;color:white;}

button{padding:10px;margin:2px;background:#007acc;color:white;border:none;}
.tab{padding:6px;background:#222;margin:4px;cursor:pointer;}

.settings{
position:fixed;right:0;top:0;width:260px;height:100%;
background:#111;padding:10px;display:none;
}
</style>
</head>

<body>

<header>üß† JARVIS 15 AUTONOMOUS SELF EVOLVING AI</header>

<div id="sidebar">
<h3>Chats</h3>
<div id="tabs"></div>
<button onclick="newTab()">‚ûï New Chat</button>
<button onclick="toggleChat()">üîΩ Toggle Chat</button>
</div>

<div id="main">
<div id="chat"></div>
<textarea id="input"></textarea>

<div>
<button onclick="send()">Send</button>
<button onclick="voiceInput()">üé§ Voice</button>
<button onclick="toggleWake()">üß† Wake</button>
<button onclick="toggleAutoAI()">‚ö° Auto AI</button>
<button onclick="openSettings()">‚öô Settings</button>
</div>
</div>

<div class="settings" id="settingsPanel">
<h3>Settings</h3>
<button onclick="toggleLang()">Language</button>
<button onclick="connectLLM()">Connect AI Brain</button>
<button onclick="connectGmail()">Connect Gmail</button>
<button onclick="closeSettings()">Close</button>
</div>

<script>

/* DATABASE */
let db=JSON.parse(localStorage.getItem("jarvis_db")||`{
memory:{},
vector:[],
tabs:{default:[]},
activeTab:"default",
wake:false,
language:"en",
llmKey:"",
gmailConnected:false,
autoAI:false,
goals:[]
}`);

function save(){localStorage.setItem("jarvis_db",JSON.stringify(db));}

/* DOM */
let chat=document.getElementById("chat");
let input=document.getElementById("input");
let tabs=document.getElementById("tabs");
let settingsPanel=document.getElementById("settingsPanel");

/* CHAT TOGGLE */
function toggleChat(){
chat.style.display=chat.style.display==="none"?"block":"none";
}

/* TABS */
function newTab(){
let name="chat"+Date.now();
db.tabs[name]=[];
db.activeTab=name;
save();
updateTabs();
loadTab();
}

function updateTabs(){
tabs.innerHTML="";
Object.keys(db.tabs).forEach(t=>{
let d=document.createElement("div");
d.className="tab";
d.innerText=t;
d.onclick=()=>{db.activeTab=t;loadTab();}
tabs.appendChild(d);
});
}

function loadTab(){
chat.innerHTML="";
(db.tabs[db.activeTab]||[]).forEach(m=>renderMessage(m.role,m.text));
}

/* MESSAGE */
function renderMessage(role,text){
let div=document.createElement("div");
div.textContent=(role==="user"?"You":"Jarvis")+": "+text;
chat.appendChild(div);
chat.scrollTop=chat.scrollHeight;
}

function add(role,text){
renderMessage(role,text);
db.tabs[db.activeTab].push({role,text});
save();
if(role==="ai") speak(text);
}

/* VOICE OUTPUT */
function speak(text){
try{
let u=new SpeechSynthesisUtterance(text);
u.lang=db.language==="hi"?"hi-IN":"en-US";
speechSynthesis.cancel();
speechSynthesis.speak(u);
}catch{}
}

document.body.onclick=()=>speechSynthesis.resume();

/* VOICE INPUT */
function voiceInput(){
let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){alert("Voice unsupported");return;}

let r=new SR();
r.lang=db.language==="hi"?"hi-IN":"en-US";

r.onresult=e=>{
input.value=e.results[0][0].transcript;
send();
};

r.start();
}

/* WAKE SYSTEM */
let wakeRec=null;

function toggleWake(){
db.wake=!db.wake;
save();
if(db.wake) startWake();
else if(wakeRec) wakeRec.stop();
}

function startWake(){
let SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR) return;

wakeRec=new SR();
wakeRec.continuous=true;

wakeRec.onresult=e=>{
let t=e.results[e.results.length-1][0].transcript.toLowerCase();
if(t.includes("jarvis")){
input.value=t.replace("jarvis","");
send();
}
};

wakeRec.start();
}

/* VECTOR MEMORY */
function vectorStore(q,a){
db.vector.push({q,a});
if(db.vector.length>300) db.vector.shift();
save();
}

function vectorSearch(text){
for(let v of db.vector){
if(text.includes(v.q)) return v.a;
}
return null;
}

/* AUTO AI */
function toggleAutoAI(){
db.autoAI=!db.autoAI;
save();
add("ai","Auto AI "+db.autoAI);
}

/* CLOUD AI */
async function askLLM(text){
if(!db.llmKey) return null;

try{
let r=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+db.llmKey
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[{role:"user",content:text}]
})
});

let j=await r.json();
return j?.choices?.[0]?.message?.content||null;

}catch{return null;}
}

function connectLLM(){
let key=prompt("Enter API Key");
if(!key) return;
db.llmKey=key;
save();
add("ai","Cloud Brain Connected");
}

/* GMAIL */
function connectGmail(){
db.gmailConnected=true;
save();
add("ai","Gmail Connected");
}

/* SETTINGS */
function openSettings(){settingsPanel.style.display="block";}
function closeSettings(){settingsPanel.style.display="none";}

function toggleLang(){
db.language=db.language==="en"?"hi":"en";
save();
add("ai","Language Switched");
}

/* ===== MEMORY DATABASE ===== */

let db = JSON.parse(localStorage.getItem("jarvisMemory")) || {
    memory:{}
};

function saveMemory(){
    localStorage.setItem("jarvisMemory", JSON.stringify(db));
}


/* ===== THINK FUNCTION ===== */

async function think(text){

text = text.trim();

/* ===== TRAIN SYSTEM ===== */

if(text.toLowerCase().startsWith("train")){

    let parts = text.split("=");

    if(parts.length === 2){

        let q = parts[0].replace("train","").trim();
        let a = parts[1].trim();

        db.memory[q] = a;
        saveMemory();

        return "‚úÖ Training saved permanently";
    }

    return "‚ö†Ô∏è Use format: train question = answer";
}


/* ===== MEMORY REPLY ===== */

if(db.memory[text]){
    return db.memory[text];
}


/* ===== EXISTING LLM CALL ===== */

let llm = await askLLM(text);
if(llm) return llm;

return "ü§ñ Talk or train me";
}


/* ===== SEND ===== */

async function send(){

let msg=input.value.trim();
if(!msg) return;

add("user",msg);
add("ai","Thinking...");

let reply=await think(msg);

/* SAFE remove thinking message */
if(chat.lastChild){
    chat.removeChild(chat.lastChild);
}

add("ai",reply);

input.value="";
}


/* ===== START ===== */

updateTabs();
loadTab();
add("ai","üöÄ Jarvis 15 Autonomous Ready");

</script>

<script>

/* ===== SERVICE WORKER ===== */

if ('serviceWorker' in navigator) {
 navigator.serviceWorker.register('sw.js');
}

</script>

</body>
</html>

